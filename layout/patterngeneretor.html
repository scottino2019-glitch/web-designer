<!doctype html>
<html lang="it">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pattern Generator</title>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }
    
    html {
      height: 100%;
    }
    
    .pattern-wrapper {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      padding: 24px;
      gap: 24px;
      overflow-y: auto;
    }
    
    .header-section {
      text-align: center;
    }
    
    .main-heading {
      font-size: 36px;
      font-weight: 800;
      margin: 0;
      padding-bottom: 8px;
    }
    
    .content-layout {
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 24px;
      flex: 1;
    }
    
    @media (max-width: 968px) {
      .content-layout {
        grid-template-columns: 1fr;
      }
    }
    
    .controls-section {
      padding: 24px;
      border-radius: 16px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 20px;
      max-height: 800px;
      overflow-y: auto;
    }
    
    .preview-section {
      padding: 40px;
      border-radius: 16px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.1);
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .section-heading {
      font-size: 16px;
      font-weight: 700;
      margin: 0 0 12px 0;
    }
    
    .pattern-types {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 8px;
    }
    
    .pattern-type-btn {
      padding: 12px;
      border: 2px solid transparent;
      border-radius: 8px;
      font-weight: 600;
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    
    .pattern-type-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .pattern-type-btn.selected {
      border-color: #3b82f6;
    }
    
    .slider-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .slider-top {
      display: flex;
      justify-content: space-between;
      font-weight: 600;
      font-size: 13px;
    }
    
    .slider-control {
      width: 100%;
      cursor: pointer;
    }
    
    .color-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .color-label {
      font-weight: 600;
      font-size: 13px;
    }
    
    .color-picker-row {
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .color-input {
      width: 60px;
      height: 40px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      cursor: pointer;
    }
    
    .color-code {
      flex: 1;
      padding: 10px;
      border: 2px solid #e2e8f0;
      border-radius: 8px;
      font-size: 13px;
      font-family: monospace;
    }
    
    .pattern-canvas-area {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      min-height: 500px;
      padding: 40px;
      overflow: hidden;
      position: relative;
    }
    
    .pattern-canvas {
      width: 100%;
      max-width: 800px;
      aspect-ratio: 1;
      border-radius: 12px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.15);
    }
    
    .button-group {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    .export-btn {
      flex: 1;
      padding: 14px 24px;
      border: none;
      border-radius: 12px;
      font-weight: 700;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      color: white;
      min-width: 150px;
    }
    
    .export-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(0,0,0,0.25);
    }
    
    .export-btn:active {
      transform: translateY(0);
    }

    .toast-notification {
      position: fixed;
      bottom: 30px;
      right: 30px;
      padding: 16px 24px;
      background: #10b981;
      color: white;
      border-radius: 12px;
      font-weight: 700;
      box-shadow: 0 8px 24px rgba(16, 185, 129, 0.4);
      z-index: 1000;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateY(100px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
<body>
  <!-- BREADCRUMB PRIMA del main - INVULNERABILE -->
 <div id="breadcrumb-container" style="
  position: fixed !important; top: 0 !important; left: 0 !important; right: 0 !important; 
  z-index: 999999 !important; 
  background: rgba(255,255,255,0.98) !important; 
  backdrop-filter: blur(30px) !important; 
  border-bottom: 2px solid #e5e7eb !important; 
  padding: 12px 24px !important; 
  box-shadow: 0 4px 20px rgba(0,0,0,0.15) !important;
">
  <div style="max-width: 1280px; margin: 0 auto !important; display: flex !important; align-items: center !important; justify-content: center !important; gap: 16px !important;">
    <a href="index.html" style="
      padding: 8px 16px !important; background: linear-gradient(135deg, #3b82f6, #1d4ed8) !important; 
      color: white !important; text-decoration: none !important; border-radius: 25px !important; 
      font-weight: 700 !important; font-size: 14px !important; box-shadow: 0 4px 12px rgba(59,130,246,0.4) !important;
      display: flex !important; align-items: center !important; gap: 8px !important;
    ">üè† Home</a>
    
    <span style="color: #9ca3af !important; font-weight: bold !important; font-size: 20px !important;">‚Ä∫</span>
    
    <span id="layout-btn" style="
      padding: 8px 16px !important; 
      background: linear-gradient(135deg, #f59e0b, #d97706) !important; 
      color: white !important; border-radius: 25px !important; 
      font-weight: 700 !important; font-size: 14px !important; cursor: pointer !important;
      box-shadow: 0 4px 12px rgba(245,158,11,0.4) !important;
      display: flex !important; align-items: center !important; gap: 8px !important;
    " onclick="toggleLayoutMenu()">üì± Layout ‚ñº</span>
    
    <div id="layout-menu" style="
      position: fixed !important; top: 70px !important; left: 50% !important; 
      transform: translateX(-50%) !important; width: 280px !important;
      background: rgba(255,255,255,0.98) !important; backdrop-filter: blur(30px) !important;
      border: 2px solid #f59e0b !important; border-radius: 20px !important; 
      box-shadow: 0 20px 60px rgba(0,0,0,0.3) !important;
      display: none !important; max-height: 300px !important; overflow-y: auto !important;
      z-index: 999998 !important; padding: 0 !important;
    ">
      <a href="layout_home.html" style="display: block !important; padding: 14px 20px !important; color: #374151 !important; text-decoration: none !important; font-weight: 600 !important; border-bottom: 1px solid #f3f4f6 !important;" onmouseenter="this.style.background='#fef3c7 !important'; this.style.paddingLeft='24px !important';" onmouseleave="this.style.background='' !important; this.style.paddingLeft='20px !important';">üè† Home Layout</a>
      <a href="gridlayoutgenerator.html" style="display: block !important; padding: 14px 20px !important; color: #374151 !important; text-decoration: none !important; font-weight: 600 !important; border-bottom: 1px solid #f3f4f6 !important;" onmouseenter="this.style.background='#dbeafe !important'; this.style.paddingLeft='24px !important';" onmouseleave="this.style.background='' !important; this.style.paddingLeft='20px !important';">üì± Generatore</a>
      <a href="generatore_grid_flex.html" style="display: block !important; padding: 14px 20px !important; color: #374151 !important; text-decoration: none !important; font-weight: 600 !important; border-bottom: 1px solid #f3f4f6 !important;" onmouseenter="this.style.background='#dbeafe !important'; this.style.paddingLeft='24px !important';" onmouseleave="this.style.background='' !important; this.style.paddingLeft='20px !important';">üì± Generatore 2</a>
      <a href="gen_grid_flex.html" style="display: block !important; padding: 14px 20px !important; color: #374151 !important; text-decoration: none !important; font-weight: 600 !important; border-bottom: 1px solid #f3f4f6 !important;" onmouseenter="this.style.background='#dbeafe !important'; this.style.paddingLeft='24px !important';" onmouseleave="this.style.background='' !important; this.style.paddingLeft='20px !important';">üì± Generatore 3</a>
      <a href="layout.html" style="display: block !important; padding: 14px 20px !important; color: #374151 !important; text-decoration: none !important; font-weight: 600 !important;" onmouseenter="this.style.background='#e9d5ff !important'; this.style.paddingLeft='24px !important';" onmouseleave="this.style.background='' !important; this.style.paddingLeft='20px !important';">üñåÔ∏è Layout</a>
        <a href="parallax-generator.html" style="display: block !important; padding: 14px 20px !important; color: #374151 !important; text-decoration: none !important; font-weight: 600 !important;" onmouseenter="this.style.background='#e9d5ff !important'; this.style.paddingLeft='24px !important';" onmouseleave="this.style.background='' !important; this.style.paddingLeft='20px !important';">üèÑ Parallax </a>
        <a href="Glassmorphism.html" style="display: block !important; padding: 14px 20px !important; color: #374151 !important; text-decoration: none !important; font-weight: 600 !important;" onmouseenter="this.style.background='#e9d5ff !important'; this.style.paddingLeft='24px !important';" onmouseleave="this.style.background='' !important; this.style.paddingLeft='20px !important';">üîÆ Glassmorph </a>
        
    </div>
    
    <span style="color: #9ca3af !important; font-weight: bold !important; font-size: 20px !important;">‚Ä∫</span>
    
    <span style="
      padding: 8px 16px !important; 
      background: linear-gradient(135deg, #10b981, #059669) !important; 
      color: white !important; border-radius: 25px !important; 
      font-weight: 800 !important; font-size: 14px !important; 
      box-shadow: 0 4px 12px rgba(16,185,129,0.4) !important;
      display: flex !important; align-items: center !important; gap: 8px !important;
    ">üåà Pattern Generator</span>
  </div>
</div>
 


  <!-- IL TUO MAIN RIMANE INVARIATO -->
  <main class="pattern-wrapper">
   <header class="header-section">
    <h1 class="main-heading" id="mainHeading">Pattern Generator</h1>
   </header>
   <!-- resto del tuo contenuto invariato... -->
  <main class="pattern-wrapper">
   <header class="header-section">
    <h1 class="main-heading" id="mainHeading">Pattern Generator</h1>
      
   </header>
   <div class="content-layout">
    <aside class="controls-section" id="controlsSection">
     <div>
      <h2 class="section-heading">Tipo Pattern</h2>
      <div class="pattern-types"><button class="pattern-type-btn selected" data-pattern="circles">‚≠ï Cerchi</button> <button class="pattern-type-btn" data-pattern="squares">‚¨õ Quadrati</button> <button class="pattern-type-btn" data-pattern="triangles">üî∫ Triangoli</button> <button class="pattern-type-btn" data-pattern="hexagons">‚¨° Esagoni</button> <button class="pattern-type-btn" data-pattern="waves">„Ä∞Ô∏è Onde</button> <button class="pattern-type-btn" data-pattern="dots">‚Ä¢ Puntini</button>
      </div>
     </div>
     <div class="slider-group">
      <div class="slider-top"><span>Dimensione</span> <span id="sizeDisplay">40px</span>
      </div><input type="range" class="slider-control" id="sizeSlider" min="20" max="100" value="40">
     </div>
     <div class="slider-group">
      <div class="slider-top"><span>Spaziatura</span> <span id="spacingDisplay">10px</span>
      </div><input type="range" class="slider-control" id="spacingSlider" min="0" max="50" value="10">
     </div>
     <div class="slider-group">
      <div class="slider-top"><span>Rotazione</span> <span id="rotationDisplay">0¬∞</span>
      </div><input type="range" class="slider-control" id="rotationSlider" min="0" max="360" value="0">
     </div>
     <div class="slider-group">
      <div class="slider-top"><span>Opacit√†</span> <span id="opacityDisplay">100%</span>
      </div><input type="range" class="slider-control" id="opacitySlider" min="10" max="100" value="100">
     </div>
     <div class="color-group"><label class="color-label">Colore Pattern</label>
      <div class="color-picker-row"><input type="color" class="color-input" id="patternColorPicker" value="#3b82f6"> <input type="text" class="color-code" id="patternColorCode" value="#3b82f6">
      </div>
     </div>
     <div class="color-group"><label class="color-label">Colore Sfondo</label>
      <div class="color-picker-row"><input type="color" class="color-input" id="bgColorPicker" value="#ffffff"> <input type="text" class="color-code" id="bgColorCode" value="#ffffff">
      </div>
     </div>
    </aside>
    <section class="preview-section" id="previewSection">
     <h2 class="section-heading">Anteprima Pattern</h2>
     <div class="pattern-canvas-area" id="canvasArea">
      <canvas class="pattern-canvas" id="patternCanvas"></canvas>
     </div>
     <div class="button-group"><button class="export-btn" id="savePngBtn">üíæ Salva PNG</button> <button class="export-btn" id="copySvgBtn">üìã Copia SVG</button> <button class="export-btn" id="copyCssBtn">üíÖ Copia CSS</button>
     </div>
    </section>
   </div>
  </main>
  <script>
    const defaultConfig = {
      background_color: "#f0f4f8",
      panel_background: "#ffffff",
      preview_background: "#e2e8f0",
      text_color: "#2d3748",
      button_color: "#3b82f6",
      font_family: "Inter",
      font_size: 16,
      app_title: "Pattern Generator"
    };

    let patternConfig = {
      type: 'circles',
      size: 40,
      spacing: 10,
      rotation: 0,
      opacity: 100,
      patternColor: '#3b82f6',
      bgColor: '#ffffff'
    };

    const patternButtons = document.querySelectorAll('.pattern-type-btn');
    const sizeSlider = document.getElementById('sizeSlider');
    const spacingSlider = document.getElementById('spacingSlider');
    const rotationSlider = document.getElementById('rotationSlider');
    const opacitySlider = document.getElementById('opacitySlider');
    const patternColorPicker = document.getElementById('patternColorPicker');
    const patternColorCode = document.getElementById('patternColorCode');
    const bgColorPicker = document.getElementById('bgColorPicker');
    const bgColorCode = document.getElementById('bgColorCode');
    const canvas = document.getElementById('patternCanvas');
    const ctx = canvas.getContext('2d');
    const savePngBtn = document.getElementById('savePngBtn');
    const copySvgBtn = document.getElementById('copySvgBtn');
    const copyCssBtn = document.getElementById('copyCssBtn');

    // Set canvas size
    function resizeCanvas() {
      const container = canvas.parentElement;
      const size = Math.min(container.clientWidth - 80, 800);
      canvas.width = size;
      canvas.height = size;
      drawPattern();
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    // Pattern type selection
    patternButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        patternButtons.forEach(b => b.classList.remove('selected'));
        btn.classList.add('selected');
        patternConfig.type = btn.dataset.pattern;
        drawPattern();
      });
    });

    // Sliders
    sizeSlider.addEventListener('input', (e) => {
      patternConfig.size = parseInt(e.target.value);
      document.getElementById('sizeDisplay').textContent = `${e.target.value}px`;
      drawPattern();
    });

    spacingSlider.addEventListener('input', (e) => {
      patternConfig.spacing = parseInt(e.target.value);
      document.getElementById('spacingDisplay').textContent = `${e.target.value}px`;
      drawPattern();
    });

    rotationSlider.addEventListener('input', (e) => {
      patternConfig.rotation = parseInt(e.target.value);
      document.getElementById('rotationDisplay').textContent = `${e.target.value}¬∞`;
      drawPattern();
    });

    opacitySlider.addEventListener('input', (e) => {
      patternConfig.opacity = parseInt(e.target.value);
      document.getElementById('opacityDisplay').textContent = `${e.target.value}%`;
      drawPattern();
    });

    // Pattern color
    patternColorPicker.addEventListener('input', (e) => {
      patternConfig.patternColor = e.target.value;
      patternColorCode.value = e.target.value;
      drawPattern();
    });

    patternColorCode.addEventListener('input', (e) => {
      const color = e.target.value;
      if (/^#[0-9A-F]{6}$/i.test(color)) {
        patternConfig.patternColor = color;
        patternColorPicker.value = color;
        drawPattern();
      }
    });

    // Background color
    bgColorPicker.addEventListener('input', (e) => {
      patternConfig.bgColor = e.target.value;
      bgColorCode.value = e.target.value;
      drawPattern();
    });

    bgColorCode.addEventListener('input', (e) => {
      const color = e.target.value;
      if (/^#[0-9A-F]{6}$/i.test(color)) {
        patternConfig.bgColor = color;
        bgColorPicker.value = color;
        drawPattern();
      }
    });

    function hexToRgba(hex, alpha) {
      const r = parseInt(hex.slice(1, 3), 16);
      const g = parseInt(hex.slice(3, 5), 16);
      const b = parseInt(hex.slice(5, 7), 16);
      return `rgba(${r}, ${g}, ${b}, ${alpha})`;
    }

    function drawPattern() {
      const { size, spacing, rotation, opacity, patternColor, bgColor } = patternConfig;
      const step = size + spacing;
      const alpha = opacity / 100;
      
      // Clear canvas
      ctx.fillStyle = bgColor;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      
      // Set pattern color with opacity
      ctx.fillStyle = hexToRgba(patternColor, alpha);
      ctx.strokeStyle = hexToRgba(patternColor, alpha);
      ctx.lineWidth = 2;
      
      const cols = Math.ceil(canvas.width / step) + 2;
      const rows = Math.ceil(canvas.height / step) + 2;
      
      for (let i = -1; i < cols; i++) {
        for (let j = -1; j < rows; j++) {
          const x = i * step + step / 2;
          const y = j * step + step / 2;
          
          ctx.save();
          ctx.translate(x, y);
          ctx.rotate((rotation * Math.PI) / 180);
          
          switch (patternConfig.type) {
            case 'circles':
              ctx.beginPath();
              ctx.arc(0, 0, size / 2, 0, Math.PI * 2);
              ctx.fill();
              break;
              
            case 'squares':
              ctx.fillRect(-size / 2, -size / 2, size, size);
              break;
              
            case 'triangles':
              ctx.beginPath();
              ctx.moveTo(0, -size / 2);
              ctx.lineTo(size / 2, size / 2);
              ctx.lineTo(-size / 2, size / 2);
              ctx.closePath();
              ctx.fill();
              break;
              
            case 'hexagons':
              ctx.beginPath();
              for (let k = 0; k < 6; k++) {
                const angle = (Math.PI / 3) * k;
                const hx = (size / 2) * Math.cos(angle);
                const hy = (size / 2) * Math.sin(angle);
                if (k === 0) ctx.moveTo(hx, hy);
                else ctx.lineTo(hx, hy);
              }
              ctx.closePath();
              ctx.fill();
              break;
              
            case 'waves':
              ctx.beginPath();
              ctx.arc(0, 0, size / 2, 0, Math.PI);
              ctx.stroke();
              break;
              
            case 'dots':
              ctx.beginPath();
              ctx.arc(0, 0, size / 4, 0, Math.PI * 2);
              ctx.fill();
              break;
          }
          
          ctx.restore();
        }
      }
    }

    function generateSVG() {
      const { size, spacing, rotation, opacity, patternColor, bgColor, type } = patternConfig;
      const step = size + spacing;
      const alpha = opacity / 100;
      const width = 800;
      const height = 800;
      
      let shapes = '';
      const cols = Math.ceil(width / step) + 2;
      const rows = Math.ceil(height / step) + 2;
      
      for (let i = -1; i < cols; i++) {
        for (let j = -1; j < rows; j++) {
          const x = i * step + step / 2;
          const y = j * step + step / 2;
          
          let shape = '';
          const transform = `transform="translate(${x},${y}) rotate(${rotation})"`;
          
          switch (type) {
            case 'circles':
              shape = `<circle cx="0" cy="0" r="${size / 2}" fill="${patternColor}" opacity="${alpha}" ${transform}/>`;
              break;
            case 'squares':
              shape = `<rect x="${-size / 2}" y="${-size / 2}" width="${size}" height="${size}" fill="${patternColor}" opacity="${alpha}" ${transform}/>`;
              break;
            case 'triangles':
              const points = `0,${-size / 2} ${size / 2},${size / 2} ${-size / 2},${size / 2}`;
              shape = `<polygon points="${points}" fill="${patternColor}" opacity="${alpha}" ${transform}/>`;
              break;
            case 'hexagons':
              let hexPoints = [];
              for (let k = 0; k < 6; k++) {
                const angle = (Math.PI / 3) * k;
                const hx = (size / 2) * Math.cos(angle);
                const hy = (size / 2) * Math.sin(angle);
                hexPoints.push(`${hx},${hy}`);
              }
              shape = `<polygon points="${hexPoints.join(' ')}" fill="${patternColor}" opacity="${alpha}" ${transform}/>`;
              break;
            case 'waves':
              shape = `<path d="M ${-size / 2} 0 A ${size / 2} ${size / 2} 0 0 1 ${size / 2} 0" stroke="${patternColor}" fill="none" stroke-width="2" opacity="${alpha}" ${transform}/>`;
              break;
            case 'dots':
              shape = `<circle cx="0" cy="0" r="${size / 4}" fill="${patternColor}" opacity="${alpha}" ${transform}/>`;
              break;
          }
          
          shapes += shape + '\n';
        }
      }
      
      return `<svg width="${width}" height="${height}" xmlns="http://www.w3.org/2000/svg">
  <rect width="${width}" height="${height}" fill="${bgColor}"/>
  ${shapes}
</svg>`;
    }

    function generateCSS() {
      const { size, spacing, patternColor, bgColor, type } = patternConfig;
      
      let cssPattern = '';
      
      switch (type) {
        case 'circles':
          cssPattern = `radial-gradient(circle, ${patternColor} ${size / 2}px, transparent ${size / 2}px)`;
          break;
        case 'squares':
          cssPattern = `repeating-linear-gradient(0deg, ${patternColor} 0px, ${patternColor} ${size}px, transparent ${size}px, transparent ${size + spacing}px),
    repeating-linear-gradient(90deg, ${patternColor} 0px, ${patternColor} ${size}px, transparent ${size}px, transparent ${size + spacing}px)`;
          break;
        case 'dots':
          cssPattern = `radial-gradient(circle, ${patternColor} ${size / 4}px, transparent ${size / 4}px)`;
          break;
        default:
          cssPattern = `/* Pattern ${type} requires SVG for complex shapes */`;
      }
      
      return `.pattern-background {
  background-color: ${bgColor};
  background-image: ${cssPattern};
  background-size: ${size + spacing}px ${size + spacing}px;
  background-position: 0 0;
}`;
    }

    function showToast(message, success = true) {
      const toast = document.createElement('div');
      toast.className = 'toast-notification';
      toast.textContent = message;
      toast.style.background = success ? '#10b981' : '#ef4444';
      document.body.appendChild(toast);
      
      setTimeout(() => {
        toast.style.animation = 'slideIn 0.3s ease-out reverse';
        setTimeout(() => {
          document.body.removeChild(toast);
        }, 300);
      }, 2000);
    }

    function copyToClipboard(text, message) {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text)
          .then(() => {
            showToast(message);
          })
          .catch(() => {
            fallbackCopy(text, message);
          });
      } else {
        fallbackCopy(text, message);
      }
    }

    function fallbackCopy(text, message) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.left = '-9999px';
      document.body.appendChild(textarea);
      textarea.select();
      
      try {
        document.execCommand('copy');
        showToast(message);
      } catch (err) {
        showToast('‚ùå Errore durante la copia', false);
      }
      
      document.body.removeChild(textarea);
    }

    // Export buttons
    savePngBtn.addEventListener('click', () => {
      const link = document.createElement('a');
      link.download = `pattern-${patternConfig.type}.png`;
      link.href = canvas.toDataURL('image/png');
      link.click();
      showToast('‚úÖ Pattern PNG salvato!');
    });

    copySvgBtn.addEventListener('click', () => {
      const svg = generateSVG();
      copyToClipboard(svg, '‚úÖ Codice SVG copiato!');
    });

    copyCssBtn.addEventListener('click', () => {
      const css = generateCSS();
      copyToClipboard(css, '‚úÖ Codice CSS copiato!');
    });

    async function onConfigChange(config) {
      const appConfig = { ...defaultConfig, ...config };
      
      document.querySelector('.pattern-wrapper').style.background = appConfig.background_color;
      document.querySelector('.controls-section').style.background = appConfig.panel_background;
      document.querySelector('.preview-section').style.background = appConfig.panel_background;
      document.querySelector('.pattern-canvas-area').style.background = appConfig.preview_background;
      
      document.querySelector('.main-heading').style.color = appConfig.text_color;
      document.querySelectorAll('.section-heading').forEach(heading => {
        heading.style.color = appConfig.text_color;
      });
      document.querySelectorAll('.color-label').forEach(label => {
        label.style.color = appConfig.text_color;
      });
      document.querySelectorAll('.slider-top').forEach(header => {
        header.style.color = appConfig.text_color;
      });
      
      document.querySelectorAll('.pattern-type-btn').forEach(btn => {
        btn.style.background = appConfig.panel_background;
        btn.style.color = appConfig.text_color;
      });
      
      document.querySelectorAll('.export-btn').forEach(btn => {
        btn.style.background = appConfig.button_color;
      });
      
      document.querySelectorAll('.color-code').forEach(input => {
        input.style.background = appConfig.panel_background;
        input.style.color = appConfig.text_color;
      });
      
      const fontFamily = appConfig.font_family;
      const baseFontStack = '-apple-system, BlinkMacSystemFont, sans-serif';
      document.querySelector('.main-heading').style.fontFamily = `${fontFamily}, ${baseFontStack}`;
      document.querySelectorAll('.section-heading').forEach(heading => {
        heading.style.fontFamily = `${fontFamily}, ${baseFontStack}`;
      });
      document.querySelectorAll('.color-label').forEach(label => {
        label.style.fontFamily = `${fontFamily}, ${baseFontStack}`;
      });
      
      const baseSize = appConfig.font_size;
      document.querySelector('.main-heading').style.fontSize = `${baseSize * 2.25}px`;
      document.querySelectorAll('.section-heading').forEach(heading => {
        heading.style.fontSize = `${baseSize}px`;
      });
      document.querySelectorAll('.color-label').forEach(label => {
        label.style.fontSize = `${baseSize * 0.8125}px`;
      });
      
      document.getElementById('mainHeading').textContent = appConfig.app_title;
    }

    function mapToCapabilities(config) {
      const appConfig = { ...defaultConfig, ...config };
      
      return {
        recolorables: [
          {
            get: () => appConfig.background_color,
            set: (value) => {
              if (window.elementSdk) {
                window.elementSdk.setConfig({ background_color: value });
              }
            }
          },
          {
            get: () => appConfig.panel_background,
            set: (value) => {
              if (window.elementSdk) {
                window.elementSdk.setConfig({ panel_background: value });
              }
            }
          },
          {
            get: () => appConfig.preview_background,
            set: (value) => {
              if (window.elementSdk) {
                window.elementSdk.setConfig({ preview_background: value });
              }
            }
          },
          {
            get: () => appConfig.text_color,
            set: (value) => {
              if (window.elementSdk) {
                window.elementSdk.setConfig({ text_color: value });
              }
            }
          },
          {
            get: () => appConfig.button_color,
            set: (value) => {
              if (window.elementSdk) {
                window.elementSdk.setConfig({ button_color: value });
              }
            }
          }
        ],
        borderables: [],
        fontEditable: {
          get: () => appConfig.font_family,
          set: (value) => {
            if (window.elementSdk) {
              window.elementSdk.setConfig({ font_family: value });
            }
          }
        },
        fontSizeable: {
          get: () => appConfig.font_size,
          set: (value) => {
            if (window.elementSdk) {
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }
      };
    }

    function mapToEditPanelValues(config) {
      const appConfig = { ...defaultConfig, ...config };
      return new Map([
        ["app_title", appConfig.app_title]
      ]);
    }

    // Initialize
    drawPattern();

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities,
        mapToEditPanelValues
      });
    } else {
      onConfigChange(defaultConfig);
    }

// FUNZIONE CLICK PER MENU LAYOUT
function toggleLayoutMenu() {
  const menu = document.getElementById('layout-menu');
  menu.style.display = menu.style.display === 'block' ? 'none' : 'block';
}

// CHIUDE MENU CLICCANDO FUORI
document.addEventListener('click', function(e) {
  const menu = document.getElementById('layout-menu');
  const btn = document.getElementById('layout-btn');
  if (menu && btn && !btn.contains(e.target) && !menu.contains(e.target)) {
    menu.style.display = 'none';
  }
});



  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a450eb455da5e95',t:'MTc2NDExNDcyMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>