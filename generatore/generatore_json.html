<!doctype html>
<html lang="it">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generatore JSON</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      box-sizing: border-box;
    }
    
    .json-output {
      font-family: 'Courier New', monospace;
      white-space: pre-wrap;
      word-wrap: break-word;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body class="w-full h-full m-0 p-0">
  <div class="w-full min-h-full p-8" id="app-container">
   <div class="max-w-4xl mx-auto">
    <h1 class="text-4xl font-bold mb-2 text-center" id="page-title">Generatore JSON</h1>
    <p class="text-center mb-8 text-lg" id="subtitle">Trasforma le tue descrizioni in file JSON strutturati</p>
    <div class="rounded-lg shadow-lg p-6 mb-6" id="input-card"><label for="description-input" class="block text-lg font-semibold mb-3" id="description-label">Descrivi la struttura JSON desiderata:</label> <textarea id="description-input" rows="6" class="w-full p-4 border-2 rounded-lg focus:outline-none focus:ring-2 text-base" placeholder="Es: Un oggetto con nome (stringa), et√† (numero), e hobbies (array di stringhe)"></textarea> <button id="generate-btn" class="w-full mt-4 px-6 py-3 rounded-lg font-semibold text-lg transition-all duration-200 transform hover:scale-105"> Genera JSON </button>
    </div>
    <div id="output-section" class="hidden">
     <div class="rounded-lg shadow-lg p-6" id="output-card">
      <div class="flex justify-between items-center mb-4">
       <h2 class="text-2xl font-bold">JSON Generato</h2><button id="download-btn" class="px-5 py-2 rounded-lg font-semibold transition-all duration-200 hover:shadow-md"> Scarica JSON </button>
      </div>
      <div class="rounded-lg p-4 overflow-auto max-h-96" id="json-container">
       <pre id="json-output" class="json-output text-sm"></pre>
      </div>
      <div class="mt-4 flex gap-3"><button id="copy-btn" class="flex-1 px-5 py-2 rounded-lg font-semibold transition-all duration-200"> üìã Copia </button> <button id="clear-btn" class="flex-1 px-5 py-2 rounded-lg font-semibold transition-all duration-200"> üóëÔ∏è Cancella </button>
      </div>
     </div>
    </div>
   </div>
  </div>
  <script>
    const defaultConfig = {
      background_color: "#f0f4f8",
      card_color: "#ffffff",
      text_color: "#1a202c",
      primary_button_color: "#3b82f6",
      secondary_button_color: "#64748b",
      font_family: "system-ui",
      font_size: 16,
      page_title: "Generatore JSON",
      description_label: "Descrivi la struttura JSON desiderata:",
      generate_button_text: "Genera JSON",
      download_button_text: "Scarica JSON"
    };

    let config = { ...defaultConfig };
    let generatedJson = null;

    async function onConfigChange(newConfig) {
      const appContainer = document.getElementById('app-container');
      const inputCard = document.getElementById('input-card');
      const outputCard = document.getElementById('output-card');
      const jsonContainer = document.getElementById('json-container');
      const generateBtn = document.getElementById('generate-btn');
      const downloadBtn = document.getElementById('download-btn');
      const copyBtn = document.getElementById('copy-btn');
      const clearBtn = document.getElementById('clear-btn');
      const pageTitle = document.getElementById('page-title');
      const descriptionLabel = document.getElementById('description-label');

      const backgroundColor = newConfig.background_color || defaultConfig.background_color;
      const cardColor = newConfig.card_color || defaultConfig.card_color;
      const textColor = newConfig.text_color || defaultConfig.text_color;
      const primaryColor = newConfig.primary_button_color || defaultConfig.primary_button_color;
      const secondaryColor = newConfig.secondary_button_color || defaultConfig.secondary_button_color;
      const fontFamily = newConfig.font_family || defaultConfig.font_family;
      const fontSize = newConfig.font_size || defaultConfig.font_size;

      appContainer.style.backgroundColor = backgroundColor;
      appContainer.style.color = textColor;
      appContainer.style.fontFamily = `${fontFamily}, system-ui, sans-serif`;

      pageTitle.style.fontSize = `${fontSize * 2}px`;
      pageTitle.style.color = textColor;
      pageTitle.textContent = newConfig.page_title || defaultConfig.page_title;

      document.getElementById('subtitle').style.fontSize = `${fontSize * 1.125}px`;
      document.getElementById('subtitle').style.color = textColor;

      descriptionLabel.style.fontSize = `${fontSize * 1.125}px`;
      descriptionLabel.style.color = textColor;
      descriptionLabel.textContent = newConfig.description_label || defaultConfig.description_label;

      inputCard.style.backgroundColor = cardColor;
      outputCard.style.backgroundColor = cardColor;
      
      const textarea = document.getElementById('description-input');
      textarea.style.fontSize = `${fontSize}px`;
      textarea.style.borderColor = secondaryColor;
      textarea.style.color = textColor;

      generateBtn.style.backgroundColor = primaryColor;
      generateBtn.style.color = '#ffffff';
      generateBtn.style.fontSize = `${fontSize * 1.125}px`;
      generateBtn.textContent = newConfig.generate_button_text || defaultConfig.generate_button_text;

      downloadBtn.style.backgroundColor = primaryColor;
      downloadBtn.style.color = '#ffffff';
      downloadBtn.style.fontSize = `${fontSize}px`;
      downloadBtn.textContent = newConfig.download_button_text || defaultConfig.download_button_text;

      jsonContainer.style.backgroundColor = backgroundColor;
      jsonContainer.style.color = textColor;

      const h2 = outputCard.querySelector('h2');
      h2.style.fontSize = `${fontSize * 1.5}px`;
      h2.style.color = textColor;

      copyBtn.style.backgroundColor = secondaryColor;
      copyBtn.style.color = '#ffffff';
      copyBtn.style.fontSize = `${fontSize}px`;

      clearBtn.style.backgroundColor = secondaryColor;
      clearBtn.style.color = '#ffffff';
      clearBtn.style.fontSize = `${fontSize}px`;

      document.getElementById('json-output').style.fontSize = `${fontSize * 0.875}px`;
    }

    function parseDescription(description) {
      const json = {};
      
      const lines = description.toLowerCase().split(/[,\n;]/);
      
      for (const line of lines) {
        const trimmed = line.trim();
        if (!trimmed) continue;
        
        if (trimmed.includes('stringa') || trimmed.includes('string') || trimmed.includes('testo') || trimmed.includes('text')) {
          const match = trimmed.match(/(\w+)/);
          if (match) {
            json[match[1]] = "esempio";
          }
        } else if (trimmed.includes('numero') || trimmed.includes('number') || trimmed.includes('et√†') || trimmed.includes('age')) {
          const match = trimmed.match(/(\w+)/);
          if (match) {
            json[match[1]] = 0;
          }
        } else if (trimmed.includes('array') || trimmed.includes('lista') || trimmed.includes('list')) {
          const match = trimmed.match(/(\w+)/);
          if (match) {
            json[match[1]] = [];
          }
        } else if (trimmed.includes('booleano') || trimmed.includes('boolean') || trimmed.includes('bool')) {
          const match = trimmed.match(/(\w+)/);
          if (match) {
            json[match[1]] = false;
          }
        } else if (trimmed.includes('oggetto') || trimmed.includes('object')) {
          const match = trimmed.match(/(\w+)/);
          if (match) {
            json[match[1]] = {};
          }
        }
      }
      
      if (Object.keys(json).length === 0) {
        return {
          campo1: "valore1",
          campo2: "valore2",
          numero: 123,
          array: ["elemento1", "elemento2"],
          attivo: true
        };
      }
      
      return json;
    }

    function generateJson() {
      const description = document.getElementById('description-input').value.trim();
      
      if (!description) {
        document.getElementById('json-output').textContent = 'Per favore, inserisci una descrizione.';
        document.getElementById('output-section').classList.remove('hidden');
        return;
      }
      
      generatedJson = parseDescription(description);
      const jsonString = JSON.stringify(generatedJson, null, 2);
      
      document.getElementById('json-output').textContent = jsonString;
      document.getElementById('output-section').classList.remove('hidden');
    }

    function downloadJson() {
      if (!generatedJson) return;
      
      const jsonString = JSON.stringify(generatedJson, null, 2);
      const blob = new Blob([jsonString], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'generated.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }

    function copyToClipboard() {
      const jsonText = document.getElementById('json-output').textContent;
      navigator.clipboard.writeText(jsonText).then(() => {
        const copyBtn = document.getElementById('copy-btn');
        const originalText = copyBtn.textContent;
        copyBtn.textContent = '‚úÖ Copiato!';
        setTimeout(() => {
          copyBtn.textContent = originalText;
        }, 2000);
      });
    }

    function clearOutput() {
      document.getElementById('description-input').value = '';
      document.getElementById('output-section').classList.add('hidden');
      generatedJson = null;
    }

    document.getElementById('generate-btn').addEventListener('click', generateJson);
    document.getElementById('download-btn').addEventListener('click', downloadJson);
    document.getElementById('copy-btn').addEventListener('click', copyToClipboard);
    document.getElementById('clear-btn').addEventListener('click', clearOutput);

    document.getElementById('description-input').addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && e.ctrlKey) {
        generateJson();
      }
    });

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.card_color || defaultConfig.card_color,
              set: (value) => {
                config.card_color = value;
                window.elementSdk.setConfig({ card_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            },
            {
              get: () => config.primary_button_color || defaultConfig.primary_button_color,
              set: (value) => {
                config.primary_button_color = value;
                window.elementSdk.setConfig({ primary_button_color: value });
              }
            },
            {
              get: () => config.secondary_button_color || defaultConfig.secondary_button_color,
              set: (value) => {
                config.secondary_button_color = value;
                window.elementSdk.setConfig({ secondary_button_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ["page_title", config.page_title || defaultConfig.page_title],
          ["description_label", config.description_label || defaultConfig.description_label],
          ["generate_button_text", config.generate_button_text || defaultConfig.generate_button_text],
          ["download_button_text", config.download_button_text || defaultConfig.download_button_text]
        ])
      });

      onConfigChange(window.elementSdk.config);
    } else {
      onConfigChange(defaultConfig);
    }
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a71712a43f93d3b',t:'MTc2NDU4MDEyOC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>